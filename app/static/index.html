<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Finan√ßas do Chimpanz√©</title>
    <style>
        /* --- CSS COMPLETO E CORRIGIDO --- */
        body { font-family: sans-serif; background-color: #f4f4f4; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        form { display: flex; gap: 10px; margin-bottom: 20px; }
        input, select { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        ul { list-style-type: none; padding: 0; }
        li { background: #eee; padding: 15px; margin-bottom: 10px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .entrada { border-left: 5px solid green; }
        .saida { border-left: 5px solid red; }

        /* Estilo para o bot√£o de deletar e para o cont√™iner da descri√ß√£o/data */
        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-weight: bold;
            line-height: 25px; /* Centraliza o "X" verticalmente */
            text-align: center; /* Centraliza o "X" horizontalmente */
            padding: 0;
        }
        li > div {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Meu Cofrinho de Bananas üçå</h1>
        
        <h2>Adicionar Nova Transa√ß√£o</h2>
        <form id="form-transacao">
            <input type="text" id="descricao" placeholder="Descri√ß√£o (ex: Compra de bananas)" required>
            <input type="number" id="valor" step="0.01" placeholder="Valor" required>
            <select id="tipo" required>
                <option value="entrada">Entrada</option>
                <option value="saida">Sa√≠da</option>
            </select>
            <button type="submit">Adicionar</button>
        </form>

        <h2>Minhas Transa√ß√µes</h2>
        <ul id="lista-transacoes">
            <!-- As transa√ß√µes aparecer√£o aqui via JavaScript -->
        </ul>

        <h2>Saldo</h2>
        <h3 id="saldo-total">R$ 0.00</h3>
    </div>

    <!-- A M√ÅGICA ACONTECE AQUI -->
    <script>
        // --- JAVASCRIPT COMPLETO E CORRIGIDO ---

        const API_URL = 'http://127.0.0.1:8000';

        const form = document.getElementById('form-transacao');
        const listaTransacoes = document.getElementById('lista-transacoes');
        const saldoTotalEl = document.getElementById('saldo-total');

        // --- Fun√ß√£o para buscar todas as transa√ß√µes e o saldo da API ---
        async function carregarDados() {
            try {
                const resTransacoes = await fetch(`${API_URL}/transacoes/`);
                const transacoes = await resTransacoes.json();
                
                const resSaldo = await fetch(`${API_URL}/saldo/`);
                const saldoData = await resSaldo.json();

                listaTransacoes.innerHTML = ''; 

                transacoes.forEach(transacao => {
                    const li = document.createElement('li');
                    li.className = transacao.tipo;
                    
                    li.innerHTML = `
                        <div>
                            <span>${transacao.descricao}</span>
                            <small>${new Date(transacao.data).toLocaleDateString('pt-BR')}</small> 
                        </div>
                        <span>R$ ${transacao.valor.toFixed(2)}</span>
                        <button class="delete-btn" onclick="deletarTransacao(${transacao.id})">X</button> 
                    `;
                    listaTransacoes.appendChild(li);
                });

                saldoTotalEl.textContent = `R$ ${saldoData.saldo.toFixed(2)}`;
            } catch (error) {
                console.error('Falha ao carregar os dados:', error);
                alert('N√£o foi poss√≠vel conectar ao servidor. Verifique se a API est√° rodando.');
            }
        }

        // --- Fun√ß√£o para adicionar uma nova transa√ß√£o ---
        async function adicionarTransacao(event) {
            event.preventDefault(); 

            const descricao = document.getElementById('descricao').value;
            const valor = parseFloat(document.getElementById('valor').value);
            const tipo = document.getElementById('tipo').value;

            // Preenchemos a fun√ß√£o que estava vazia!
            await fetch(`${API_URL}/transacoes/`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ descricao, valor, tipo }),
            });

            form.reset();
            carregarDados();
        }

        // --- Fun√ß√£o para deletar uma transa√ß√£o ---
        async function deletarTransacao(id) {
            if (!confirm('Tem certeza que quer deletar esta transa√ß√£o?')) {
                return;
            }

            await fetch(`${API_URL}/transacoes/${id}`, {
                method: 'DELETE',
            });

            carregarDados();
        }

        // --- Eventos ---
        document.addEventListener('DOMContentLoaded', carregarDados);
        form.addEventListener('submit', adicionarTransacao);

    </script>
</body>
</html>